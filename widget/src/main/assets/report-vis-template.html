<!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.2//EN"
        "http://www.openmobilealliance.org/tech/DTD/xhtml-mobile12.dtd">

<head xmlns="http://www.w3.org/1999/html">

    <title>TIBCO Jaspersoft</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">

    <script type="text/javascript">
        var MobileReport = (function () {
            var self = this;

            var setupBaseUrl = function (callback) {
                var metaScript = document.createElement("base");
                metaScript.onload = callback;
                metaScript.setAttribute('href', self.config.server.url);
                document.head.appendChild(metaScript);
            };

            var setupVisualizeScript = function (callback) {
                var visScript = document.createElement('script');
                visScript.onload = callback;
                visScript.setAttribute('src', self.config.server.url + "client/visualize.js");
                document.head.appendChild(visScript);
            };

            var loadVisualize = function () {
                var onComplete = function (v) {
                    self.visualize = v;
                    if (Android !== undefined) {
                        Android.onVisualizeReady();
                    }
                };

                var auth = self.config.auth;
                if (auth === undefined) {
                    visualize(onComplete);
                } else {
                    visualize({auth: auth}, onComplete);
                }
            };

            function Report() {
                return {
                    init: function (config) {
                        self.config = config;
                        setupBaseUrl(setupVisualizeScript(loadVisualize));
                    },
                    run: function (uri) {
                        self.visualize("#container").report({
                            resource: uri,
                            error: function (e) {
                                console.log(e);
                            }
                        });
                    }
                }
            }

            var instance;
            return {
                getInstance: function () {
                    if (instance == null) {
                        instance = new Report();
                        instance.constructor = null;
                    }
                    return instance;
                }
            };
        })();
    </script>
</head>
<body>
<div id="container"></div>
</body>